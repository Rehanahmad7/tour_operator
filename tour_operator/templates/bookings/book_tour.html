{% extends 'base.html' %}

{% block title %}Book {{ tour_date.tour_package.name }} - Tour Operator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h1>Book Your Tour</h1>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">{{ tour_date.tour_package.name }}</h5>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Dates:</strong> {{ tour_date.start_date }} - {{ tour_date.end_date }}</p>
                        <p><strong>Duration:</strong> {{ tour_date.tour_package.duration }} days</p>
                        <p><strong>Location:</strong> {{ tour_date.tour_package.location }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Price per person:</strong> ₹{{ tour_date.tour_package.price }}</p>
                        <p><strong>Available spots:</strong> {{ tour_date.available_spots }}</p>
                        <p><strong>Difficulty:</strong> {{ tour_date.tour_package.get_difficulty_display }}</p>
                    </div>
                </div>
            </div>
        </div>

        <form method="post">
            {% csrf_token %}
            <div class="card">
                <div class="card-header">
                    <h5>Booking Details</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="{{ form.participants.id_for_label }}" class="form-label">Number of Participants</label>
                        {{ form.participants }}
                        {% if form.participants.errors %}
                            <div class="text-danger">{{ form.participants.errors }}</div>
                        {% endif %}
                        <div class="form-text">Maximum {{ tour_date.available_spots }} participants available for this date.</div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.special_requests.id_for_label }}" class="form-label">Special Requests</label>
                        {{ form.special_requests }}
                        {% if form.special_requests.errors %}
                            <div class="text-danger">{{ form.special_requests.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="booking-summary p-3 bg-light rounded">
                        <h6>Booking Summary</h6>
                        <div id="price-calculation">
                            <p>Price per person: ₹{{ tour_date.tour_package.price }}</p>
                            <p>Participants: <span id="participant-count">1</span></p>
                            <hr>
                            <h5>Total: ₹<span id="total-price">{{ tour_date.tour_package.price }}</span></h5>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="btn btn-primary">Confirm Booking</button>
                    <a href="{% url 'tour_detail' tour_date.tour_package.id %}" class="btn btn-secondary">Cancel</a>
                </div>
            </div>
        </form>
    </div>

    <div class="col-md-4">
       
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const participantsInput = document.getElementById('id_participants');
    const pricePerPerson = {{ tour_date.tour_package.price }};

    function updatePrice() {
        const participants = parseInt(participantsInput.value) || 1;
        const total = participants * pricePerPerson;
        document.getElementById('participant-count').textContent = participants;
        document.getElementById('total-price').textContent = total;
    }

    if (participantsInput) {
        participantsInput.addEventListener('input', updatePrice);
        updatePrice();
    }
});
</script>
{% endblock %}